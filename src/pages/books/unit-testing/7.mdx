---
id: 단위 테스트
title: '7장, 가치 있는 단위 테스트를 위한 리팩터링'
description: '단위 테스트 책을 읽고 내용을 정리합니다.'
keywords: 'unit testing, book, study'
createdAt: 2022.03.28
---

## 7.1 리팩터링할 코드 식별하기

### 7.1.1 코드의 네 가지 유형으로

모든 제품 코드는 2차원으로 분류할 수 있다.

- **복잡도 또는 도메인 유의성**
- **협력자 수**

**코드 복잡도(code complexity)**는 코드 내의 의사 결정(분기) 지점 수로 정의한다. 분기가 많을수록 복잡도도 높아진다.<br/>

**도메인 유의성(domain significance)** : 코드가 프로젝트의 문제 도메인에 얼마나 의미 있는지를 나타낸다.<br/>
도메인 계층의 모든 코드는 최종 사용자의 목표와 직접적인 연관성이 있으므로 도메인 유의성이 높다.<br/>

**복잡한 코드와 도메인 유의성을 갖는 코드가 단위 테스트에서 가장 이롭다.**<br/>
해당 테스트는 회귀 방지에 뛰어나기 때문이다. 도메인 코드는 복잡할 필요가 없으며, 복잡한 코드는 도메인 유의성이 나타나지 않아도 테스트할 만하다.<br/>

협력자의 유형도 중요하다. 도메인 모델이라면 프로세스 외부 협력자를 사용하면 안 된다.<br/>
목 체계가 복잡하여 유지비가 더 들기 때문이다. 또한, 리팩터링 내성을 잘 지키려면 애플리케이션 경계를 넘는 상호 작용을 검증하는 데만 사용해야 한다.<br/>

도메인 모델 및 알고리즘을 단위 테스트하면 노력 대비 가장 이롭다. 이러한 단위 테스트는 매우 가치 있고 저렴하다.<br/>
해당 코드가 복잡하거나 중요한 로직을 수행해서 테스트의 회귀 방지가 향상되기 때문에 가치 있다.<br/>
또한, 코드에 협력자가 없어서 테스트 유지비를 낮추기 떄문에 저렴하다.<br/>

코드 복잡도, 도메인 유의성 협력자 수의 조합으로 네 가지 코드 유형을 볼 수 있다.<br/>

- **도메인 모델과 알고리즘**
- **간단한 코드**
- **컨트롤러**
- **지나치게 복잡한 코드**

<img src='/assets/images/unit-testing-20.jpg' />
<br />

**가장 문제가 되는 코드 유형은 지나치게 복잡한 코드다.**<br/>
실제 구현이 까다로울수 있지만, 지나치게 복잡한 코드를 알고리즘과 컨트롤러라는 두 부분으로 나누는 것이 일반적이다.

> 코드가 더 중요해지거나 복잡해질수록 협력자는 더 적어야 한다.<br/>
> 좋지 않은 테스트를 작성하는 것보다는 테스트를 전혀 작성하지 않는 편이 낫다.

### 7.1.2 험블 객체 패턴을 사용해 지나치게 복잡한 코드 분할하기

**지나치게 복잡한 코드를 쪼개려면, 험블 객체 패턴(Humeble Object)을 써야한다.**

<img src='/assets/images/unit-testing-21.jpg' />
<br />

테스트 대상 코드의 로직을 테스트하려면, 테스트가 가능한 부분을 추출해야 한다. 결과적으로 코드는 테스트 가능한 부분을 둘러싼 얇은 험블 래퍼(humble wrapper)가 된다.

<img src='/assets/images/unit-testing-22.jpg' />
<br />

사실 육각형 아키텍처와 함수형 아키텍처 모두 정확히 이 패턴을 구현한다.<br/>
육각형 아키텍처는 비지니스 로직과 프로세스 외부 의존성과의 통신을 분리한다. 이는 도메인 계층과 애플리케이션 서비스 계층이 각각 담당하는 것이다.<br/>

함수형 아키텍처는 더 나아가 프로세스 외부 의존성뿐만 아니라 모든 협력자와의 커뮤니케이션에서 비지니스 로직을 분리한다.<br/>
즉, 함수형 코어에는 아무런 협력자도 없다. 함수형 코어의 모든 의존성은 불변이다.<br/>

험블 객체 패턴을 보는 또 다른 방법은 단일 책임 원칙을 지키는 것이다. 이는 각 클래스가 단일한 책임만 가져야 한다는 원칙이다.
그러한 책임 중 하나로 늘 비지니스 로직이 있는데, 이 패턴을 적용하면 비지니스 로직을 거의 모든 것과 분리할 수 있다.

테스트 가능한 설계가 어떻게 테스트를 용이하게 할 뿐만 아니라 유지 보수도 쉽게 해주는지에 대해 생각하면 흥미로운 부분이다.
